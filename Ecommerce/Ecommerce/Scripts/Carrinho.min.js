var produtosLeveTambemCarregados=!1,ftg=!1;function LoaderTr(e){e?($(".tableRow").fadeOut(0),$(".loaderTrCarrinho").remove(),$("#itensPedidos").append('<td colspan="5" class="loaderTrCarrinho" style="border-top: 1px solid #e6e6e6;height: 130px;"><div class="lds-ellipsis" id="loaderDivProdutosA" style="width: 80px;height: 80px;position: relative;left: 50%;right: 50%;top: 50%;z-index: 100000000;transform: translate(-50%,-50%);"><div></div><div></div><div></div><div></div></div></td>')):($(".loaderTrCarrinho").remove(),$(".tableRow").fadeIn())}function CarregarCarrinho(){LoaderTr(!0),$.ajax({type:"GET",url:"/Pedidos/ObterCarrinhoFrete",success:function(e){if(e.sucesso){if(e.obj.Carrinho.length<=0)return $("#divCarrinho").empty(),$("#divCarrinho").append("<div style='width:100%;padding:20px; text-align:center'>Carrinho vazio :(</div>"),void CarregarLeveTambem();var r=0,a=0;e.obj.Carrinho.forEach(function(e,o){r+=e.valor*e.qtd,a+=e.valor*e.qtd,e.valor=e.valor.toString().replace(".",",")}),$("#codCupom").val().length>0&&$("#valorCupom").val().length>0&&(r-=parseFloat($("#valorCupom").val().replace(",",".")),$("#divFrete").removeClass("bor12"),$("#divDesconto").fadeIn(),$("#desconto").text($("#valorCupom").val().replace(".",","))),null!=e.obj.Frete.SEDEX?($("#btnSEDEX")[0].checked=!0,$("#frete").text(e.obj.Frete.SEDEX.price.replace(".",",")),$("#trSEDEX").fadeIn(0),$("#valorSEDEX").text(e.obj.Frete.SEDEX.price.replace(".",",")),$("#qtdDiasSEDEX").text(e.obj.Frete.SEDEX.delivery_time),$("#valFreteSEDEXCrip").val(e.obj.Frete.SEDEXValor),$("#valPrazoSEDEXCrip").val(e.obj.Frete.SEDEXPrazo),e.obj.FreteGratis||(r+=parseFloat(e.obj.Frete.SEDEX.price.replace(",",".")))):$("#trSEDEX").fadeOut(0),null!=e.obj.Frete.PAC?($("#trPAC").fadeIn(0),$("#valorPAC").text(e.obj.Frete.PAC.price.replace(".",",")),$("#qtdDiasPAC").text(e.obj.Frete.PAC.delivery_time),$("#valFretePACCrip").val(e.obj.Frete.PACValor),$("#valPrazoPACCrip").val(e.obj.Frete.PACPrazo),null==e.obj.Frete.SEDEX&&($("#btnPAC")[0].checked=!0,$("#frete").text(e.obj.Frete.PAC.price.replace(".",",")),e.obj.FreteGratis||(r+=parseFloat(e.obj.Frete.PAC.price.replace(",","."))))):$("#trPAC").fadeOut(0),$("#total").text(r.toFixed(2).replace(".",",")),$("#subTotal").text(a.toFixed(2).replace(".",",")),localStorage.setItem("aioCar",JSON.stringify({offUser:!1,car:e.obj.Carrinho})),o=e.obj.Carrinho,$(".tableRow").remove(),o.forEach(function(e,r){e.valor=parseFloat(e.valor.toString().replace(",",".")).toFixed(2).replace(".",",");var a=`<tr class="tableRow">\n                                <td style="padding: 15px 14px 15px 19px;">\n                                    <a href="${e.url}"><img src="${e.urlImg}" alt="${e.nome}" title="${e.nome}" style="width: 90px;"></a>\n                                </td>\n                                <td style="text-align: left; cursor:pointer" onclick="window.location.href = '${e.url}'" title="${e.nome}">${e.nome}<br/><small style="color: #717fe0;display: block;">${e.obs}</small></td>\n                                <td style="padding: 0 7px;">R$ ${e.valor}</td>\n                                <td>\n                                    <div class="wrap-num-product flex-w m-l-auto m-r-0 tdItemQtd">\n                                        <div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m" onclick="RemoverCar(${e.cod}, '${e.obs}', true)" title="Remover">\n                                            <i class="fs-16 zmdi zmdi-minus"></i>\n                                        </div>\n                                        <input class="mtext-104 cl3 txt-center num-product" type="number" name="num-product1" value="${e.qtd}" readonly="true">\n                                        <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m" onclick="AddCar(${e.cod}, '${e.nome}', '${e.valor}', 1, '${e.urlImg}', '${e.url}', '${e.obs}', true)" title="Adicionar">\n                                            <i class="fs-16 zmdi zmdi-plus"></i>\n                                        </div>\n                                    </div>\n                                </td>\n                                <td style="padding: 0 7px;">R$ ${(parseFloat(e.valor.replace(",","."))*e.qtd).toFixed(2).replace(".",",")}</td>\n                            </tr>`;$("#itensPedidos").append(a)}),LoaderTr(!1),(ftg=e.obj.FreteGratis)?($(".divFrete").fadeOut(0),$("#simbRS").fadeOut(0),$("#frete").text("GRÁTIS").css("color","green")):($("#frete").css("color","#333"),$("#simbRS").fadeIn(0),$(".divFrete").fadeIn(0))}else swal("Atenção",e.mensagem,"error");var o;LoadCar(),CarregarLeveTambem()},error:function(e){swal("Atenção","Erro ao tentar conectar-se ao servidor. Tente novamente.","error"),LoadCar(),LoaderTr(!1)}})}function CarregarCEP(e){e.length>0&&$.ajax({type:"GET",url:"https://viacep.com.br/ws/"+e+"/json/",success:function(e){JSON.stringify(e).indexOf("cep")>0&&($('input[name="Logradouro"]').val(e.logradouro),$('input[name="Complemento"]').val(e.complemento),$('input[name="Bairro"]').val(e.bairro),$('input[name="Cidade"]').val(e.localidade),$('select[name="UF"]').val(e.uf))},error:function(e){console.log(e)}})}function ValidarCad2(){var e=!0,r=$("input[name='CEP']").val().trim(),a=$("input[name='Logradouro']").val().trim(),o=$("input[name='Numero']").val().trim(),t=$("input[name='Complemento']").val().trim(),n=$("input[name='Bairro']").val().trim(),l=$("input[name='Cidade']").val().trim(),i=$("select[name='UF']").val().trim();return r.length<=0||r.length>8?($("input[name='CEP']").css("border","1px solid red"),e=!1):$("input[name='CEP']").css("border","1px solid #e6e6e6"),a.length<=0||a.length>100?($("input[name='Logradouro']").css("border","1px solid red"),e=!1):$("input[name='Logradouro']").css("border","1px solid #e6e6e6"),o.length<=0||o.length>10?($("input[name='Numero']").css("border","1px solid red"),e=!1):$("input[name='Numero']").css("border","1px solid #e6e6e6"),t.length>50?($("input[name='Complemento']").css("border","1px solid red"),e=!1):$("input[name='Complemento']").css("border","1px solid #e6e6e6"),n.length<=0||n.length>45?($("input[name='Bairro']").css("border","1px solid red"),e=!1):$("input[name='Bairro']").css("border","1px solid #e6e6e6"),l.length<=0||l.length>32?($("input[name='Cidade']").css("border","1px solid red"),e=!1):$("input[name='Cidade']").css("border","1px solid #e6e6e6"),"0"==i||i.length>2||i.length<=0?($("select[name='UF']").css("border","1px solid red"),e=!1):$("select[name='UF']").css("border","1px solid #e6e6e6"),e}function PopularEndereco(e){$("input[name='CEP']").val(e.CEP),$("input[name='Logradouro']").val(e.Logradouro),$("input[name='Numero']").val(e.Numero),$("input[name='Complemento']").val(e.Complemento),$("input[name='Bairro']").val(e.Bairro),$("input[name='Cidade']").val(e.Cidade),$("select[name='UF']").val(e.UF),$("#endereco").empty(),$("#endereco").append(e.Logradouro+", "+e.Numero+(null!=e.Complemento&&""!=e.Complemento?", "+e.Complemento:"")+"<br>"+e.Bairro+", "+e.Cidade+"-"+e.UF+", "+e.CEP)}function SalvarEndereco(){if($("#iconBtnSalvar").fadeIn(0),ValidarCad2()){var e={CEP:$("input[name='CEP']").val().trim(),Logradouro:$("input[name='Logradouro']").val(),Numero:$("input[name='Numero']").val(),Complemento:$("input[name='Complemento']").val(),Bairro:$("input[name='Bairro']").val(),Cidade:$("input[name='Cidade']").val(),UF:$("select[name='UF']").val()};$.ajax({type:"POST",url:"/Usuario/SalvarEndereco",data:e,success:function(e){e.sucesso?($("#divAlterarEndereco").fadeOut(0),$("#divEndereco").fadeIn(),$("#iconBtnSalvar").fadeOut(0),PopularEndereco(e.obj),UpScroll(),CarregarCarrinho()):($("#iconBtnSalvar").fadeOut(0),swal("Atenção",e.mensagem,"error"))},error:function(e){swal("Atenção","Erro ao tentar conectar-se ao servidor. Tente novamente.","error"),$("#iconBtnSalvar").fadeOut(0)}})}else $("#iconBtnSalvar").fadeOut(0)}function ObterEndereco(){$.ajax({type:"GET",url:"/Usuario/ObterEndereco",success:function(e){e.sucesso&&(PopularEndereco(e.obj),CarregarCarrinho())}})}function AplicarCupom(){var e=$('input[name="cupom"]').val().trim();e.length<=0||e.length>50?$("input[name='cupom']").css("border","1px solid red"):($("input[name='cupom']").css("border","1px solid #e6e6e6"),$.ajax({type:"GET",url:"/Pedidos/ObterCupom",data:{codigo:e},success:function(e){e.sucesso?($("#codCupom").val(e.obj.CodCupom),$("#valorCupom").val(e.obj.Valor),CarregarCarrinho(),swal("Cupom Aplicado","O desconto foi adicionado.","success")):swal("Atenção",e.mensagem,"error")},error:function(e){swal("Atenção","Erro ao tentar conectar-se ao servidor. Tente novamente.","error")}}))}function Cadastrar(){$("#iconBtnFinalizar").fadeIn(0);var e=$("#btnSEDEX")[0].checked?$("#valFreteSEDEXCrip").val():$("#valFretePACCrip").val(),r=$("#btnSEDEX")[0].checked?$("#valPrazoSEDEXCrip").val():$("#valPrazoPACCrip").val();$.ajax({type:"POST",url:"/Pedidos/Cadastrar",data:{p:{CodCupom:""==$("#codCupom").val()?0:$("#codCupom").val(),ValorFrete:ftg?0:e,TipoFrete:ftg?"A DECIDIR":$("#btnSEDEX")[0].checked?"SEDEX":"PAC"},valorFreteCrip:ftg?0:e,diasFreteCrip:r},success:function(e){e.sucesso?window.location.href="/Pagamento/Pedido/"+e.obj.CodPedido:(swal("Atenção",e.mensagem,"error"),$("#iconBtnFinalizar").fadeOut(0))},error:function(e){swal("Atenção","Erro ao tentar conectar-se ao servidor. Tente novamente.","error"),$("#iconBtnFinalizar").fadeOut(0)}})}function ChangeFrete(){var e=$("#btnSEDEX")[0].checked?parseFloat($("#valorSEDEX").text().replace(",",".")):parseFloat($("#valorPAC").text().replace(",",".")),r=parseFloat($("#total").text().replace(",","."));r-=parseFloat($("#frete").text().replace(",",".")),r+=e,$("#frete").text(e.toFixed(2).replace(".",",")),$("#total").text(r.toFixed(2).replace(".",","))}function CarregarLeveTambem(){produtosLeveTambemCarregados||(CarregarProdutos("Leve também","divProdutos",24,"loaderDivProdutos"),produtosLeveTambemCarregados=!0)}$(()=>{LoaderTr(!0),ObterEndereco(),$('input[name="CEP"]').mask("000000000")});